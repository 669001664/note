##### 1.é«˜é˜¶ç»„ä»¶çš„åˆè¡·

ç»„ä»¶æ˜¯æŠŠ`prop`æ¸²æŸ“æˆ`UI`,è€Œé«˜é˜¶ç»„ä»¶æ˜¯å°†ç»„ä»¶è½¬æ¢æˆå¦å¤–ä¸€ä¸ªç»„ä»¶ï¼Œæˆ‘ä»¬æ›´åº”è¯¥æ³¨æ„çš„æ˜¯ï¼Œç»è¿‡åŒ…è£…åçš„ç»„ä»¶ï¼Œè·å¾—äº†é‚£äº›å¼ºåŒ–,èŠ‚çœå¤šå°‘é€»è¾‘ï¼Œæˆ–æ˜¯è§£å†³äº†åŸæœ‰ç»„ä»¶çš„é‚£äº›ç¼ºé™·ï¼Œè¿™å°±æ˜¯é«˜é˜¶ç»„ä»¶çš„æ„ä¹‰ã€‚æˆ‘ä»¬å…ˆæ¥æ€è€ƒä¸€ä¸‹é«˜é˜¶ç»„ä»¶ç©¶ç«Ÿè§£å†³äº†ä»€ä¹ˆé—®é¢˜ğŸ¤”ğŸ¤”ğŸ¤”ï¼Ÿ

**â‘  å¤ç”¨é€»è¾‘**ï¼šé«˜é˜¶ç»„ä»¶æ›´åƒæ˜¯ä¸€ä¸ªåŠ å·¥`react`ç»„ä»¶çš„å·¥å‚ï¼Œæ‰¹é‡å¯¹åŸæœ‰ç»„ä»¶è¿›è¡Œ**åŠ å·¥**ï¼Œ**åŒ…è£…**å¤„ç†ã€‚æˆ‘ä»¬å¯ä»¥æ ¹æ®ä¸šåŠ¡éœ€æ±‚å®šåˆ¶åŒ–ä¸“å±çš„`HOC`,è¿™æ ·å¯ä»¥è§£å†³å¤ç”¨é€»è¾‘ã€‚

**â‘¡ å¼ºåŒ–props**ï¼šè¿™ä¸ªæ˜¯`HOC`æœ€å¸¸ç”¨çš„ç”¨æ³•ä¹‹ä¸€ï¼Œé«˜é˜¶ç»„ä»¶è¿”å›çš„ç»„ä»¶ï¼Œå¯ä»¥åŠ«æŒä¸Šä¸€å±‚ä¼ è¿‡æ¥çš„`props`,ç„¶åæ··å…¥æ–°çš„`props`,æ¥å¢å¼ºç»„ä»¶çš„åŠŸèƒ½ã€‚ä»£è¡¨ä½œ`react-router`ä¸­çš„`withRouter`ã€‚

**â‘¢ èµ‹èƒ½ç»„ä»¶**ï¼š`HOC`æœ‰ä¸€é¡¹ç‹¬ç‰¹çš„ç‰¹æ€§ï¼Œå°±æ˜¯å¯ä»¥ç»™è¢«`HOC`åŒ…è£¹çš„ä¸šåŠ¡ç»„ä»¶ï¼Œæä¾›ä¸€äº›æ‹“å±•åŠŸèƒ½ï¼Œæ¯”å¦‚è¯´**é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸï¼Œé¢å¤–çš„äº‹ä»¶**ï¼Œä½†æ˜¯è¿™ç§`HOC`ï¼Œå¯èƒ½éœ€è¦å’Œä¸šåŠ¡ç»„ä»¶ç´§å¯†ç»“åˆã€‚å…¸å‹æ¡ˆä¾‹`react-keepalive-router`ä¸­çš„ `keepaliveLifeCycle`å°±æ˜¯é€šè¿‡`HOC`æ–¹å¼ï¼Œç»™ä¸šåŠ¡ç»„ä»¶å¢åŠ äº†é¢å¤–çš„ç”Ÿå‘½å‘¨æœŸã€‚

**â‘£ æ§åˆ¶æ¸²æŸ“**ï¼šåŠ«æŒæ¸²æŸ“æ˜¯`hoc`ä¸€ä¸ªç‰¹æ€§ï¼Œåœ¨`wrapComponent`åŒ…è£…ç»„ä»¶ä¸­ï¼Œå¯ä»¥å¯¹åŸæ¥çš„ç»„ä»¶ï¼Œè¿›è¡Œ`æ¡ä»¶æ¸²æŸ“`ï¼Œ`èŠ‚æµæ¸²æŸ“`ï¼Œ`æ‡’åŠ è½½`ç­‰åŠŸèƒ½ï¼Œåé¢ä¼šè¯¦ç»†è®²è§£ï¼Œå…¸å‹ä»£è¡¨åš`react-redux`ä¸­`connect`å’Œ `dva`ä¸­ `dynamic` ç»„ä»¶æ‡’åŠ è½½ã€‚

##### 2.é«˜é˜¶ç»„ä»¶ä½¿ç”¨å’Œç¼–å†™ç»“æ„

å¯¹äº`class`å£°æ˜çš„æœ‰çŠ¶æ€ç»„ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨è£…é¥°å™¨æ¨¡å¼ï¼Œå¯¹ç±»ç»„ä»¶è¿›è¡ŒåŒ…è£…ï¼š

```jsx
@withStyles(styles)
@withRouter
@keepaliveLifeCycle
class Index extends React.Componen{
    /* ... */
}
```

**æˆ‘ä»¬è¦æ³¨æ„ä¸€ä¸‹åŒ…è£…é¡ºåºï¼Œè¶Šé è¿‘`Index`ç»„ä»¶çš„ï¼Œå°±æ˜¯è¶Šå†…å±‚çš„`HOC`,ç¦»ç»„ä»¶`Index`ä¹Ÿå°±è¶Šè¿‘ã€‚**

å¯¹äºæ— çŠ¶æ€ç»„ä»¶(å‡½æ•°å£°æ˜ï¼‰æˆ‘ä»¬å¯ä»¥è¿™ä¹ˆå†™ï¼š

```jsx
function Index(){
    /* .... */
}
export default withStyles(styles)(withRouter( keepaliveLifeCycle(Index) )) 
```

###### æ¨¡å‹ï¼šåµŒå¥—HOC

å¯¹äºä¸éœ€è¦ä¼ é€’å‚æ•°çš„`HOC`ï¼Œæˆ‘ä»¬ç¼–å†™æ¨¡å‹æˆ‘ä»¬åªéœ€è¦åµŒå¥—ä¸€å±‚å°±å¯ä»¥ï¼Œæ¯”å¦‚`withRouter`,

```jsx
function withRouter(){
    return class wrapComponent extends React.Component{
        /* ç¼–å†™é€»è¾‘ */
    }
}
```

å¯¹äºéœ€è¦å‚æ•°çš„`HOC`ï¼Œæˆ‘ä»¬éœ€è¦ä¸€å±‚ä»£ç†ï¼Œå¦‚ä¸‹

```jsx
function connect (mapStateToProps){
    /* æ¥å—ç¬¬ä¸€ä¸ªå‚æ•° */
    return function connectAdvance(wrapCompoent){
        /* æ¥å—ç»„ä»¶ */
        return class WrapComponent extends React.Component{  }
    }
}
```

##### 3.ä¸¤ç§ä¸åŒçš„é«˜é˜¶ç»„ä»¶

å¸¸ç”¨çš„é«˜é˜¶ç»„ä»¶æœ‰ä¸¤ç§æ–¹å¼`æ­£å‘çš„å±æ€§ä»£ç†`å’Œ`åå‘çš„ç»„ä»¶ç»§æ‰¿`

###### 1.æ­£å‘çš„å±æ€§ä»£ç†

æ‰€è°“æ­£å‘å±æ€§ä»£ç†ï¼Œå°±æ˜¯ç”¨ç»„ä»¶åŒ…è£¹ä¸€å±‚ä»£ç†ç»„ä»¶ï¼Œåœ¨ä»£ç†ç»„ä»¶ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›ï¼Œå¯¹æºç»„ä»¶çš„ä»£ç†æ“ä½œã€‚åœ¨`fiber tree` ä¸Šï¼Œå…ˆ`mounted`ä»£ç†ç»„ä»¶ï¼Œç„¶åæ‰æ˜¯æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ã€‚æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºçˆ¶å­ç»„ä»¶å…³ç³»ï¼Œçˆ¶ç»„ä»¶å¯¹å­ç»„ä»¶è¿›è¡Œä¸€ç³»åˆ—å¼ºåŒ–æ“ä½œã€‚

```jsx
function HOC(WrapComponent){
    return class Advance extends React.Component{
       state={
           name:'alien'
       }
       render(){
           return <WrapComponent  { ...this.props } { ...this.state }  />
       }
    }
}
```

ä¼˜ç‚¹

- â‘  æ­£å¸¸å±æ€§ä»£ç†å¯ä»¥å’Œä¸šåŠ¡ç»„ä»¶ä½è€¦åˆï¼Œé›¶è€¦åˆï¼Œå¯¹äº`æ¡ä»¶æ¸²æŸ“`å’Œ`propså±æ€§å¢å¼º`,åªè´Ÿè´£æ§åˆ¶å­ç»„ä»¶æ¸²æŸ“å’Œä¼ é€’é¢å¤–çš„`props`å°±å¯ä»¥ï¼Œæ‰€ä»¥æ— é¡»çŸ¥é“ï¼Œä¸šåŠ¡ç»„ä»¶åšäº†äº›ä»€ä¹ˆã€‚æ‰€ä»¥æ­£å‘å±æ€§ä»£ç†ï¼Œæ›´é€‚åˆåšä¸€äº›å¼€æºé¡¹ç›®çš„`hoc`ï¼Œç›®å‰å¼€æºçš„`HOC`åŸºæœ¬éƒ½æ˜¯é€šè¿‡è¿™ä¸ªæ¨¡å¼å®ç°çš„ã€‚
- â‘¡ åŒæ ·é€‚ç”¨äº`class`å£°æ˜ç»„ä»¶ï¼Œå’Œ`function`å£°æ˜çš„ç»„ä»¶ã€‚
- â‘¢ å¯ä»¥å®Œå…¨éš”ç¦»ä¸šåŠ¡ç»„ä»¶çš„æ¸²æŸ“,ç›¸æ¯”åå‘ç»§æ‰¿ï¼Œå±æ€§ä»£ç†è¿™ç§æ¨¡å¼ã€‚å¯ä»¥å®Œå…¨æ§åˆ¶ä¸šåŠ¡ç»„ä»¶æ¸²æŸ“ä¸å¦ï¼Œå¯ä»¥é¿å…`åå‘ç»§æ‰¿`å¸¦æ¥ä¸€äº›å‰¯ä½œç”¨ï¼Œæ¯”å¦‚ç”Ÿå‘½å‘¨æœŸçš„æ‰§è¡Œã€‚
- â‘£ å¯ä»¥åµŒå¥—ä½¿ç”¨ï¼Œå¤šä¸ª`hoc`æ˜¯å¯ä»¥åµŒå¥—ä½¿ç”¨çš„ï¼Œè€Œä¸”ä¸€èˆ¬ä¸ä¼šé™åˆ¶åŒ…è£…`HOC`çš„å…ˆåé¡ºåºã€‚

ç¼ºç‚¹

- â‘  ä¸€èˆ¬æ— æ³•ç›´æ¥è·å–ä¸šåŠ¡ç»„ä»¶çš„çŠ¶æ€ï¼Œå¦‚æœæƒ³è¦è·å–ï¼Œéœ€è¦`ref`è·å–ç»„ä»¶å®ä¾‹ã€‚
- â‘¡ æ— æ³•ç›´æ¥ç»§æ‰¿é™æ€å±æ€§ã€‚å¦‚æœéœ€è¦ç»§æ‰¿éœ€è¦æ‰‹åŠ¨å¤„ç†ï¼Œæˆ–è€…å¼•å…¥ç¬¬ä¸‰æ–¹åº“ã€‚

```jsx
class Index extends React.Component{
  render(){
    return <div> hello,world  </div>
  }
}
Index.say = function(){
  console.log('my name is alien')
}
function HOC(Component) {
  return class wrapComponent extends React.Component{
     render(){
       return <Component { ...this.props } { ...this.state } />
     }
  }
}
const newIndex =  HOC(Index) 
console.log(newIndex.say) // undefined
```

###### 2.åå‘ç»§æ‰¿

åå‘ç»§æ‰¿å’Œå±æ€§ä»£ç†æœ‰ä¸€å®šçš„åŒºåˆ«ï¼Œåœ¨äºåŒ…è£…åçš„ç»„ä»¶ç»§æ‰¿äº†ä¸šåŠ¡ç»„ä»¶æœ¬èº«ï¼Œæ‰€ä»¥æˆ‘ä»¬æˆ‘æ— é¡»åœ¨å»å®ä¾‹åŒ–æˆ‘ä»¬çš„ä¸šåŠ¡ç»„ä»¶ã€‚å½“å‰é«˜é˜¶ç»„ä»¶å°±æ˜¯ç»§æ‰¿åï¼ŒåŠ å¼ºå‹çš„ä¸šåŠ¡ç»„ä»¶ã€‚è¿™ç§æ–¹å¼ç±»ä¼¼äºç»„ä»¶çš„å¼ºåŒ–ï¼Œæ‰€ä»¥ä½ å¿…è¦è¦çŸ¥é“å½“å‰

```jsx
class Index extends React.Component{
  render(){
    return <div> hello,world  </div>
  }
}
function HOC(Component){
    return class wrapComponent extends Component{ /* ç›´æ¥ç»§æ‰¿éœ€è¦åŒ…è£…çš„ç»„ä»¶ */

    }
}
export default HOC(Index) 
```

ä¼˜ç‚¹

- â‘  æ–¹ä¾¿è·å–ç»„ä»¶å†…éƒ¨çŠ¶æ€ï¼Œæ¯”å¦‚`state`ï¼Œ`props` ,ç”Ÿå‘½å‘¨æœŸ,ç»‘å®šçš„äº‹ä»¶å‡½æ•°ç­‰
- â‘¡ `es6`ç»§æ‰¿å¯ä»¥è‰¯å¥½ç»§æ‰¿é™æ€å±æ€§ã€‚æˆ‘ä»¬æ— é¡»å¯¹é™æ€å±æ€§å’Œæ–¹æ³•è¿›è¡Œé¢å¤–çš„å¤„ç†ã€‚

```jsx
class Index extends React.Component{
  render(){
    return <div> hello,world  </div>
  }
}
Index.say = function(){
  console.log('my name is alien')
}
function HOC(Component) {
  return class wrapComponent extends Component{
  }
}
const newIndex =  HOC(Index) 
console.log(newIndex.say)
```

ç¼ºç‚¹

- â‘  æ— çŠ¶æ€ç»„ä»¶æ— æ³•ä½¿ç”¨ã€‚
- â‘¡ å’Œè¢«åŒ…è£…çš„ç»„ä»¶å¼ºè€¦åˆï¼Œéœ€è¦çŸ¥é“è¢«åŒ…è£…çš„ç»„ä»¶çš„å†…éƒ¨çŠ¶æ€ï¼Œå…·ä½“æ˜¯åšä»€ä¹ˆï¼Ÿ
- â‘¢ å¦‚æœå¤šä¸ªåå‘ç»§æ‰¿`hoc`åµŒå¥—åœ¨ä¸€èµ·ï¼Œå½“å‰çŠ¶æ€ä¼šè¦†ç›–ä¸Šä¸€ä¸ªçŠ¶æ€ã€‚è¿™æ ·å¸¦æ¥çš„éšæ‚£æ˜¯éå¸¸å¤§çš„ï¼Œæ¯”å¦‚è¯´æœ‰å¤šä¸ª`componentDidMount`ï¼Œå½“å‰`componentDidMount`ä¼šè¦†ç›–ä¸Šä¸€ä¸ª`componentDidMount`ã€‚è¿™æ ·å‰¯ä½œç”¨ä¸²è”èµ·æ¥ï¼Œå½±å“å¾ˆå¤§ã€‚

##### 4.ç¼–å†™é«˜é˜¶ç»„ä»¶

###### 1.æ··å…¥props

```jsx
import React from 'react';

function classHoc (WarpComponent) {
  return class HocComponent extends React.Component {
    state = {
      name: 'lisi'
    }

    componentDidMount () {
      console.log('HOC', this.props)
    }

    render () {
      return <WarpComponent {...this.state} {...this.props} />
    }
  }
}

class Index extends React.Component {

  componentDidMount () {
    console.log('index', this.props)
  }

  render () {
    return <div>{this.props.name}</div>
  }
}

function FuncIndex (props) {
  const { name } = props;
  React.useEffect(() => {
    console.log("Func", props)
  }, [props])

  return (
    <div>{name}</div>
  )
}

const NewIndex = classHoc(Index);
const NewFuncIndex = classHoc(FuncIndex);

const App = () => {

  return (
    <><NewIndex /><NewFuncIndex /></>
  )
}

export default App;
index {name: 'lisi'}
 HOC {}
 HOC {}
Func {name: 'lisi'}
```

###### 2. æŠ½ç¦»stateæ§åˆ¶æ›´æ–°

```jsx
function classHoc(WrapComponent) {
  return class HocComponent extends React.Component {
    constructor() {
      super()
      this.state = {
        name: 'lisi'
      }
    }

    changeName(name) {
      this.setState({ name})
    }

    render() {
      return (
        <WrapComponent {...this.state} {...this.props} changeName={this.changeName.bind(this)} />
      )
    }
  }
}

class Index extends React.Component {
  constructor() {
    super()
    this.state={
      value: ''
    }
  }
  render() {
    return (
      <div>
        name:{this.props.name}
        <input type="text" onChange={(e) => this.setState({value: e.target.value})}/>
        <button onClick={() =>this.props.changeName(this.state.value)}>æ›´æ”¹</button>
      </div>
    )
  }
}

const NewIndex = classHoc(Index)

const App = () => {

  return (
    <><NewIndex /></>
  )
}

export default App;
```

###### 3.åˆ†ç‰‡æ¸²æŸ“

**è¿›é˜¶ï¼šå®ç°ä¸€ä¸ªæ‡’åŠ è½½åŠŸèƒ½çš„HOCï¼Œå¯ä»¥å®ç°ç»„ä»¶çš„åˆ†ç‰‡æ¸²æŸ“,ç”¨äºåˆ†ç‰‡æ¸²æŸ“é¡µé¢ï¼Œä¸è‡³äºä¸€æ¬¡æ¸²æŸ“å¤§é‡ç»„ä»¶é€ æˆç™½å±æ•ˆæœ**

```jsx
const renderQueue = [];
let isRenderFlag = false;

const tryRender = () => { // æ‰§è¡Œäº†å››æ¬¡
  const render = renderQueue.shift();
  if (!render) return;
  setTimeout(() => {
    render();
  }, 3000)
}

const renderHoc = (WrapComponent) => {
  return (props) => {
    const [render, setRender] = React.useState(false);
    React.useEffect(() => {
      renderQueue.push(() => {
        setRender(true)
      })
      if (!isRenderFlag) {
        tryRender()
        isRenderFlag = true;
      }
    }, []);
    return (
      render && <WrapComponent {...props} />
    )
  }
}

const Index = (props) => {
  React.useEffect(() => {
    tryRender();  // å»æ§åˆ¶ä¸‹ä¸€ä¸ªç»„ä»¶çš„æ¸²æŸ“
  }, []);
  const { name } = props;
  return (
    <div style={{width: '200px', height: '200px', backgroundColor: 'blue', margin: '20px auto'}}>
      {name}
    </div>
  )
}

const NewIndex = renderHoc(Index);

const App = () => {

  return (
    <>
      <NewIndex name='1' />
      <NewIndex name='2' />
      <NewIndex name='3' />
    </>
  )
}

export default App;
```

###### 4.åå‘ç»§æ‰¿ï¼šæ¸²æŸ“åŠ«æŒ

**HOCåå‘ç»§æ‰¿æ¨¡å¼ï¼Œå¯ä»¥å®ç°é¢—ç²’åŒ–çš„æ¸²æŸ“åŠ«æŒï¼Œä¹Ÿå°±æ˜¯å¯ä»¥æ§åˆ¶åŸºç±»ç»„ä»¶çš„`render`å‡½æ•°ï¼Œè¿˜å¯ä»¥ç¯¡æ”¹propsï¼Œæˆ–è€…æ˜¯`children`**

```jsx
const HOC = (WrapComponent) => {
  return class Index extends WrapComponent {
    render () {
      if (this.props.visible) {
        return super.render()
      } else {
        return <div>æš‚æ— æ•°æ®</div>
      }
    }
  }
}

class Index extends React.Component {
  render () {
    return (
      <div>
        123
      </div>
    )
  }
}

const NewIndex = HOC(Index)

const App = () => {

  return (
    <>
      <NewIndex visible />
      <NewIndex visible={false} />
    </>
  )
}

export default App;
```

###### 5. è¿›é˜¶ï¼šå®šåˆ¶åŒ–æ¸²æŸ“æµ

æ€è€ƒï¼šğŸ¤”ä¸Šè¿°çš„æ¡ˆä¾‹åªæ˜¯ä»‹ç»äº†åŸç†ï¼Œåœ¨å®é™…é¡¹ç›®ä¸­ï¼Œæ˜¯é‡åŒ–ç”Ÿäº§ä¸äº†çš„ï¼ŒåŸå› æ˜¯ï¼Œæˆ‘ä»¬éœ€è¦é’ˆå¯¹ä¸åŒ`props`å˜åŒ–ï¼Œå†™ä¸åŒçš„`HOC`ç»„ä»¶ï¼Œè¿™æ ·æ ¹æœ¬èµ·ä¸äº†`Hoc`çœŸæ­£çš„ç”¨é€”ï¼Œä¹Ÿå°±æ˜¯`HOC`äº§ç”Ÿçš„åˆè¡·ã€‚æ‰€ä»¥æˆ‘ä»¬éœ€è¦å¯¹ä¸Šè¿°`hoc`è¿›è¡Œæ”¹é€ å‡çº§ï¼Œæ˜¯ç»„ä»¶å¯ä»¥æ ¹æ®å®šåˆ¶åŒ–æ–¹å‘ï¼Œå»æ¸²æŸ“ç»„ä»¶ã€‚ä¹Ÿå°±æ˜¯`Hoc`ç”Ÿæˆçš„æ—¶å€™ï¼Œå·²ç»æŒ‰ç…§æŸç§å¥‘çº¦å»æ‰§è¡Œæ¸²æŸ“

```jsx
const HOC = (WrapComponent) => {
  return function Index (rule) {
    return function RenderElement (props) {
      const dep = rule(props);
      // eslint-disable-next-line react-hooks/exhaustive-deps
      const renderElement = useMemo(() => <WrapComponent {...props} />, [dep])
      return renderElement;
    }
  }
}

class Index extends React.Component {
  render () {
    console.log('index render');
    return <div>
      num{this.props.num}: num1 {this.props.num1}
    </div>
  }
}
class Index1 extends React.Component {
  render () {
    console.log('index1 rendet');
    return <div>
      num{this.props.num}: num1 {this.props.num1}
    </div>
  }
}

const NewIndex = HOC(Index)(props => props['num'])
const NewIndex1 = HOC(Index1)(props => props['num1'])

const App = () => {

  const [num, setNum] = React.useState(1)
  const [num1, setNum1] = React.useState(2)
  return (
    <>
      <NewIndex num={num} num1={num1} />
      <NewIndex1 num={num} num1={num1} />
      <button onClick={() => setNum(num + 1)}>num</button> //åªè§¦å‘indexçš„render ä¸ä¼šè§¦å‘ index1çš„render
      <button onClick={() => setNum1(num1 + 1)}>num1</button> //åªè§¦å‘index1çš„render ä¸ä¼šè§¦å‘ indexçš„render
    </>
  )
}

export default App;
```

###### 6.åŠ«æŒåŸå‹é“¾-åŠ«æŒç”Ÿå‘½å‘¨æœŸï¼Œäº‹ä»¶å‡½æ•°

```jsx
const HOC = (WrapComponent) => {
  return function Index (props) {
    const proComponentDid = WrapComponent.prototype.componentDidMount;
    WrapComponent.prototype.componentDidMount = () => {
      proComponentDid()
      console.log('åŠ«æŒ');
    }
    return (
      <WrapComponent {...props} />
    )
  }
}

class Index extends React.Component {
  componentDidMount () {
    console.log('Indexçš„');
  }
  render () {
    return (
      <div>
        111111111
      </div>
    )
  }
}

const NewIndex = HOC(Index);

const App = () => {

  const [num, setNum] = React.useState(1)
  const [num1, setNum1] = React.useState(2)
  return (
    <>
      <NewIndex num={num} num1={num1} />
      <button onClick={() => setNum(num + 1)}>num</button>
      <button onClick={() => setNum1(num1 + 1)}>num1</button>
    </>
  )
}

export default App;
```

###### 7.äº‹ä»¶ç›‘æ§

`HOC`è¿˜å¯ä»¥å¯¹åŸæœ‰ç»„ä»¶è¿›è¡Œç›‘æ§ã€‚æ¯”å¦‚å¯¹ä¸€äº›`äº‹ä»¶ç›‘æ§`ï¼Œ`é”™è¯¯ç›‘æ§`ï¼Œ`äº‹ä»¶ç›‘å¬`ç­‰ä¸€ç³»åˆ—æ“ä½œã€‚ç»„ä»¶å†…çš„äº‹ä»¶ç›‘å¬,åªå¯¹ç»„ä»¶å†…çš„ç‚¹å‡»äº‹ä»¶åšä¸€ä¸ªç›‘å¬æ•ˆæœã€‚

```jsx
const HOC = (WrapComponent) => {
  return function Index (props) {
    const domRef = React.useRef(null)
    React.useEffect(() => {
      const node = domRef.current;
      const handleClick = (e) => console.log('HOC click', e);
      node?.addEventListener('click', handleClick)
      return () => node?.removeEventListener('click', handleClick)
    }, []);

    return (
      <div ref={domRef}>
        <WrapComponent  {...props} />
      </div>
    )
  }
}

const Index = () => {
  return (
    <div style={{ width: '200px', height: '200px', border: '1px solid black', margin: '50px auto' }}>
      1111
        <div style={{border: '1px solid black', margin: '10px auto', width: '100px'}}>
          222
        </div>
      <button>444444</button>
    </div>
  )
}

const NewIndex = HOC(Index)

const App = () => {

  const [num, setNum] = React.useState(1)
  const [num1, setNum1] = React.useState(2)
  return (
    <>
      <NewIndex />
      <button onClick={() => setNum(num + 1)}>num</button>
      <button onClick={() => setNum1(num1 + 1)}>num1</button>
    </>
  )
}

export default App;
```

###### 8.é”™è¯¯ç›‘æ§

```jsx
import React from 'react';
//  ç±»å¼
function withErrorBoundary(WrappedComponent) {
    return class extends React.Component {
        state = {
            hasError: false,
            errorMessage: '',
        }

        static getDerivedStateFromError(error){
            return {
                hasError:true,
                errorMessage: error.message,
            }
        }

        componentDidCatch(error, errorInfo) {
            // è®°å½•é”™è¯¯ä¿¡æ¯å¹¶å‘é€åˆ°æœåŠ¡å™¨
            console.error(error, errorInfo);
            this.setState({
                hasError: true,
                errorMessage: error.message,
            });
        }

        render() {
            if (this.state.hasError) {
                // åœ¨å¼€å‘ç¯å¢ƒä¸­å±•ç¤ºé”™è¯¯ä¿¡æ¯
                if (process.env.NODE_ENV === 'development') {
                    return <div>{this.state.errorMessage}</div>;
                }
                // åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿”å›ä¸€ä¸ªé”™è¯¯æç¤ºç•Œé¢
                return <div>Oops! Something went wrong.</div>;
            }
            return <WrappedComponent {...this.props} />;
        }
    }
}

// åŸå§‹ç»„ä»¶
function MyComponent() {
    return <div>Hello, world!</div>;
}

// æ·»åŠ é”™è¯¯ç›‘æ§çš„é«˜é˜¶ç»„ä»¶
const MyComponentWithErrorBoundary = withErrorBoundary(MyComponent);


// å‡½æ•°å¼
import React from 'react';

// é«˜é˜¶å‡½æ•°ï¼Œç”¨äºæ·»åŠ é”™è¯¯ç›‘æ§é€»è¾‘
const withErrorBoundary = WrappedComponent => props => {
    const [hasError, setHasError] = React.useState(false);
    const [errorMessage, setErrorMessage] = React.useState('');

    // é”™è¯¯å¤„ç†å‡½æ•°
    const handleErrors = (error, errorInfo) => {
        console.error(error, errorInfo);
        setHasError(true);
        setErrorMessage(error.message);
    };

    // å¦‚æœç»„ä»¶å‘ç”Ÿé”™è¯¯ï¼Œåˆ™è¿”å›é”™è¯¯æç¤ºç•Œé¢
    if (hasError) {
        if (process.env.NODE_ENV === 'development') {
            return <div>{errorMessage}</div>;
        }
        return <div>Oops! Something went wrong.</div>;
    }

    // å¦åˆ™ï¼Œè¿”å›åŸå§‹ç»„ä»¶
    return <WrappedComponent {...props} onError={handleErrors} />;
};

// åŸå§‹ç»„ä»¶
import React from 'react';

const MyComponent = (props) => {
    const handleClick = () => {
        try {
            // some code that may throw an error
        } catch (error) {
            props.onError(error);
        }
    };

    return (
        <div>
            <button onClick={handleClick}>Click Me</button>
        </div>
    );
};

export default MyComponent;

// æ·»åŠ é”™è¯¯ç›‘æ§çš„ç»„ä»¶
const MyComponentWithErrorBoundary = withErrorBoundary(MyComponent);


const HOC = (WrapComponent) => {
    return function Index (props) {
        const [hasError, setHasError] = React.useState(false);
        const [error, setError] = React.useState('');

        const onError = (error, errorInfo) => {
            console.log(error, errorInfo);
            setHasError(true);
            setError(error.message)
        }

        if (hasError) {
            if (process.env.NODE_ENV === 'develoment') {
                return <div>{error}</div>
            }
            return <div>å‡ºé”™äº†</div>
        }
        return <WrapComponent onError={onError}  {...props} />

    }
}

const Index = ({ onError }) => {

    function divide (a, b) {
        if (b === 0) {
            throw new Error('é™¤æ•°ä¸èƒ½ä¸ºé›¶');
        }
        return a / b;
    }

    React.useEffect(() => {
        try {
            const result = divide(10, 0);
            console.log(result);
        } catch (error) {
            console.log('å‘ç”Ÿäº†ä¸€ä¸ªé”™è¯¯ï¼š' + error.message);
            onError(error)
        }
    }, [onError])

    return (
        <div>
            1321414
        </div>
    )
}

```



